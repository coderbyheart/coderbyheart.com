{"componentChunkName":"component---src-page-post-tsx","path":"/javascript-dependency-management-with-greenkeeper-on-aws-codebuild","result":{"data":{"site":{"siteMetadata":{"title":"Markus Tacker","tagLine":"Software Crafter","description":"Software Crafter building üå©Ô∏è cloud-based cellular IoT solutions at Nordic Semiconductor.‚Äã\n\t\tMentor. Speaker. ‚ÄãConference & Community builder. Camper. üèïÔ∏è üöê","gitHubUrl":"https://github.com/coderbyheart/coderbyheart.com.git","siteUrl":"https://coderbyheart.com","twitter":"@coderbyheart","defaultCard":"https://images.ctfassets.net/bncv3c2gt878/3Jk4P6nFPNzaz1gsguktk8/350b7e4ddb2c7d86416243d9902920e2/social-card-default-2020.png"}}},"pageContext":{"page":{"id":"e54f43de-dca8-5b56-b964-6f7520ff7bab","name":"javascript-dependency-management-with-greenkeeper-on-aws-codebuild","relativeDirectory":"post","relativePath":"post/javascript-dependency-management-with-greenkeeper-on-aws-codebuild.md","remark":{"htmlAst":{"children":[{"children":[{"properties":{"src":"//images.ctfassets.net/bncv3c2gt878/oECQFo2RBWIF0wlGuW1JS/0ca8dda9c5ddbbf63070525494cd9de0/hero.png?w=2000&h=1000","alt":"Greenkeeper on AWS Codebuild"},"children":[],"tagName":"img","type":"element"}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"I recently had the opportunity to look into some fundamental Continuous\nIntegration and Deployment techniques we use to build\n"},{"children":[{"children":[],"type":"text","value":"nrfcloud.com"}],"tagName":"a","properties":{"href":"https://nrfcloud.com/","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"},{"children":[],"type":"text","value":". We rely heavily on AWS, so it was natural\nto look into using "},{"children":[{"children":[],"type":"text","value":"AWS CodeBuild"}],"tagName":"a","properties":{"href":"https://aws.amazon.com/de/codebuild/","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"},{"children":[],"type":"text","value":" as a\ntask runner for our private repositories."}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"I previously had a fantastic experience working with\n"},{"children":[{"children":[],"type":"text","value":"Travis CI"}],"tagName":"a","properties":{"href":"https://travis-ci.com/","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"},{"children":[],"type":"text","value":", but it adds a hefty fixed price to an\ninfrastructure. On AWS CodeBuild costs occur only during the runtime of jobs\n(which are run in Docker containers). This, and a potential better integration\nwith other AWS services, gave me the initial reason to look into using it as the\nmain task runner for our TypeScript projects."}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"If you work with JavaScript the number one reason for changes in your software\nare "},{"children":[{"children":[],"type":"text","value":"dependencies"}],"tagName":"strong","properties":{},"type":"element"},{"children":[],"type":"text","value":". The number of dependencies that changes on a daily basis\nis staggering. The only sane way to deal with this "},{"children":[{"children":[],"type":"text","value":"quirk"}],"tagName":"em","properties":{},"type":"element"},{"children":[],"type":"text","value":" of the JavaScript\neco-system is to fully embrace it. Roll with the tide and make sure your\nsoftware runs with the latest version of its dependencies."}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"One precondition is to "},{"children":[{"children":[],"type":"text","value":"have tests"}],"tagName":"strong","properties":{},"type":"element"},{"children":[],"type":"text","value":". The benefits of tested software,\nespecially in a fast-moving environment, are manifold and I have been practicing\nTDD for many years. Tests will ensure that a piece of software still works if\nyou change a dependency."}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"Another invaluable helper is "},{"children":[{"children":[],"type":"text","value":"Greenkeeper"}],"tagName":"a","properties":{"href":"https://greenkeeper.io/","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"},{"children":[],"type":"text","value":": it will\nsend you a pull-request if a dependency is updated, which will in turn trigger a\nCI build. If everything works fine, you are left with merging a PR. It's a\n1-click solution to updating dependencies and it makes working with dependencies\nfun again."}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"Since npm 5 there is also a new and improved lockfile:\n"},{"children":[{"children":[{"children":[],"type":"text","value":"package-lock.json"}],"tagName":"code","properties":{},"type":"element"}],"tagName":"a","properties":{"href":"https://docs.npmjs.com/files/package-lock.json","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"},{"children":[],"type":"text","value":", which is\na huge improvement over the old shrinkwrap. It ensures that when running\n"},{"children":[{"children":[],"type":"text","value":"npm ci"}],"tagName":"code","properties":{},"type":"element"},{"children":[],"type":"text","value":" only the exact dependencies described in the lockfile will be\ninstalled. This enables "},{"children":[{"children":[],"type":"text","value":"reproducible builds"}],"tagName":"a","properties":{"href":"https://reproducible-builds.org/","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"},{"children":[],"type":"text","value":"\nbuilds of our package and we can be certain that we have the exact same executed\ncode in production that we ran when testing."}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"Greenkeeper has an addon called\n"},{"children":[{"children":[{"children":[],"type":"text","value":"greenkeeper-lockfile"}],"tagName":"code","properties":{},"type":"element"}],"tagName":"a","properties":{"href":"https://github.com/greenkeeperio/greenkeeper-lockfile","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"},{"children":[],"type":"text","value":"\nwhich takes care of updating the lockfile just for the dependency after a\nsuccessful test run."}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"A changed dependency also calls for a new release of the host package, and this\nin turn will trigger updates and releases to packages that depend on the host\npackage. Managing this manually "},{"children":[{"children":[],"type":"text","value":"would simply be insane"}],"tagName":"em","properties":{},"type":"element"},{"children":[],"type":"text","value":", or just plain\nmonotonous. But thankfully to\n"},{"children":[{"children":[{"children":[],"type":"text","value":"semantic-release"}],"tagName":"code","properties":{},"type":"element"}],"tagName":"a","properties":{"href":"https://github.com/semantic-release/semantic-release","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"},{"children":[],"type":"text","value":" the\nprocess of release new versions can also be automated! (I have explained the\nwhole the process in\n"},{"children":[{"children":[],"type":"text","value":"these slides"}],"tagName":"a","properties":{"href":"https://docs.google.com/presentation/d/1TSnZOaey_5J48d5tAKci8YjOtWkR3D6C2NG6_XKseZU/edit","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"},{"children":[],"type":"text","value":"\nin 2016)."}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"All of the tools above require Node.js v8 andw when I started to run the first\nof our packages on AWS CodeBuild the official Node.js Docker image did only\nsupport Node.js v4 and v6. This\n"},{"children":[{"children":[],"type":"text","value":"has been fixed on May 2nd"}],"tagName":"a","properties":{"href":"https://github.com/aws/aws-codebuild-docker-images/issues/45#issuecomment-385828419","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"},{"children":[],"type":"text","value":"\nand CodeBuild now has an official Node.js v8.11 image."}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"I already had begun to add CodeBuild support to\n"},{"children":[{"children":[{"children":[],"type":"text","value":"env-ci"}],"tagName":"code","properties":{},"type":"element"}],"tagName":"a","properties":{"href":"https://github.com/pvdlg/env-ci","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"},{"children":[],"type":"text","value":", which Greenkeeper uses to detect if\nit is running in a CI environment and in which. Since the official images uses\nan outdated Git version (1.9) it required\n"},{"children":[{"children":[],"type":"text","value":"some back and forth"}],"tagName":"a","properties":{"href":"https://github.com/pvdlg/env-ci/pull/28","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"},{"children":[],"type":"text","value":" until we figured\nit out."}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"The next task was to get "},{"children":[{"children":[],"type":"text","value":"greenkeeper-lockfile"}],"tagName":"code","properties":{},"type":"element"},{"children":[],"type":"text","value":" to work in AWS CodeBuild runs\nwhich I have implemented\n"},{"children":[{"children":[],"type":"text","value":"in this PR"}],"tagName":"a","properties":{"href":"https://github.com/greenkeeperio/greenkeeper-lockfile/pull/151","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"},{"children":[],"type":"text","value":".\nAlso here I needed to deal with a quite old Git version and figuring out\nCodeBuilds way of cloning the repo. It also does not provide all the necessary\ndetails about the build in the environments so I needed to persist that during\nthe build, since "},{"children":[{"children":[],"type":"text","value":"greenkeeper-lockfile"}],"tagName":"code","properties":{},"type":"element"},{"children":[],"type":"text","value":" will apply changes to the repository --\nit is updating the lockfile and commit this back to the PR."}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"Using a "},{"children":[{"children":[],"type":"text","value":"buildspec.yml"}],"tagName":"code","properties":{},"type":"element"},{"children":[],"type":"text","value":" like this we finally can have automated library releases\nand dependency management on AWS CodeBuild!"}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[{"children":[{"children":[],"type":"text","value":"version: 0.2\nphases:\n  install:\n    commands:\n      - echo \"updating git ...\"; apt-get update; apt-get install -y python-software-properties software-properties-common; add-apt-repository ppa:git-core/ppa; apt-get update; apt-get install -y git\n      - npm install -g npm@\n      - npm install -g nRFCloud/greenkeeper-lockfile\n      - npx greenkeeper-lockfile-update\n      - npm ci --no-audit\n  build:\n    commands:\n      - npm test\n  post_build:\n    commands:\n      - npx greenkeeper-lockfile-upload\n      - npx semantic-release"}],"tagName":"code","properties":{"className":["language-text"]},"type":"element"}],"tagName":"pre","properties":{"className":["language-text"]},"type":"element"}],"tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"Notes:"}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"we update git to the latest stable version, since "},{"children":[{"children":[],"type":"text","value":"semantic-release"}],"tagName":"code","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"now depends on >=2.0.0"}],"tagName":"a","properties":{"href":"https://github.com/semantic-release/semantic-release/compare/v15.4.4...v15.5.0","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"}],"tagName":"li","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"we run "},{"children":[{"children":[],"type":"text","value":"npm install -g npm@"}],"tagName":"code","properties":{},"type":"element"},{"children":[],"type":"text","value":" to ensure we are running the latest stable npm"}],"tagName":"li","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"we use our\n"},{"children":[{"children":[],"type":"text","value":"patched version of greenkeeper-lockfile"}],"tagName":"a","properties":{"href":"https://github.com/nRFCloud/greenkeeper-lockfile","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"}],"tagName":"li","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"we disable audit on "},{"children":[{"children":[],"type":"text","value":"npm ci"}],"tagName":"code","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"to not slow down the install"}],"tagName":"a","properties":{"href":"https://twitter.com/coderbyheart/status/994089445346435073","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"}],"tagName":"li","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"}],"tagName":"ul","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"And here is the result on a real PR:"}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"properties":{"src":"//images.ctfassets.net/bncv3c2gt878/4G6cWvNnKUhdzNqoQ9hzLc/f4f773c970503ace3c6b544d23d33224/Screenshot_20180521_092433.png?w=1605&h=1096","alt":"Screenshot 20180521 092433"},"children":[],"tagName":"img","type":"element"}],"tagName":"p","properties":{},"type":"element"}],"type":"root","data":{"quirksMode":false}},"frontmatter":{"title":"JavaScript Dependency Management with Greenkeeper on AWS CodeBuild","subtitle":"Continuous Integration of JavaScript projects","noheadline":null,"date":"2018-05-21T14:00+02:00","abstract":"You can now run Greenkeeper with lockfile support on AWS CodeBuild.","lang":null},"headings":[]}},"Footer":{"id":"cfe5b9e2-511c-5615-992a-dab82e1f8ed7","name":"Footer","relativeDirectory":"","relativePath":"Footer.md","remark":{"htmlAst":{"children":[{"children":[{"children":[],"type":"text","value":"Software Crafter building üå©Ô∏è cloud-based cellular IoT solutions at\n"},{"children":[{"children":[],"type":"text","value":"Nordic Semiconductor"}],"tagName":"a","properties":{"href":"https://nordicsemi.com/","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"},{"children":[],"type":"text","value":"."},{"children":[],"tagName":"br","properties":{},"type":"element"},{"children":[],"type":"text","value":"\nMentor. Speaker. Conference & Community builder. Camper. üèïÔ∏è üöê"}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[{"children":[{"children":[],"tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"type":"element"}],"tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"type":"element"}],"tagName":"a","properties":{"href":"#markus-tacker","ariaLabel":"markus tacker permalink","className":["anchor","before"]},"type":"element"},{"children":[],"type":"text","value":"Markus Tacker"}],"tagName":"h2","properties":{"id":"markus-tacker","style":"position:relative;"},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[{"children":[],"type":"text","value":"Media Computer Scientist (B.Sc.)"}],"tagName":"strong","properties":{},"type":"element"}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"üì® "},{"children":[{"children":[],"type":"text","value":"m@coderbyheart.com"}],"tagName":"a","properties":{"href":"mailto:m@coderbyheart.com","target":"_blank","rel":["nofollow","noreferrer"]},"type":"element"}],"tagName":"li","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"}],"tagName":"ul","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[{"children":[{"children":[],"tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"type":"element"}],"tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"type":"element"}],"tagName":"a","properties":{"href":"#connect","ariaLabel":"connect permalink","className":["anchor","before"]},"type":"element"},{"children":[],"type":"text","value":"Connect"}],"tagName":"h2","properties":{"id":"connect","style":"position:relative;"},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"You can find me on these sites."}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[{"children":[],"type":"text","value":"Please note that I will reject connection requests from people I've never met\npersonally."}],"tagName":"em","properties":{},"type":"element"}],"tagName":"p","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[],"type":"text","value":"\n"},{"children":[{"children":[{"children":[],"type":"text","value":"Mastodon"}],"tagName":"a","properties":{"rel":["me"],"href":"https://chaos.social/@coderbyheart","title":"Markus Tacker on Mastodon"},"type":"element"}],"tagName":"li","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[{"children":[],"type":"text","value":"Matrix"}],"tagName":"a","properties":{"rel":["me"],"href":"https://matrix.to/#/@coderbyheart:matrix.im","title":"Markus Tacker on Matrix"},"type":"element"}],"tagName":"li","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[{"children":[],"type":"text","value":"LinkedIn"}],"tagName":"a","properties":{"rel":["me"],"href":"https://www.linkedin.com/in/markustacker","title":"Markus Tacker on LinkedIn"},"type":"element"}],"tagName":"li","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[{"children":[],"type":"text","value":"GitHub"}],"tagName":"a","properties":{"rel":["me"],"href":"https://github.com/coderbyheart","title":"Markus Tacker on GitHub"},"type":"element"}],"tagName":"li","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"},{"children":[{"children":[{"children":[],"type":"text","value":"Instagram"}],"tagName":"a","properties":{"rel":["me"],"href":"https://www.instagram.com/coderbyheart/","title":"Markus Tacker on Instagram"},"type":"element"}],"tagName":"li","properties":{},"type":"element"},{"children":[],"type":"text","value":"\n"}],"tagName":"ul","properties":{},"type":"element"}],"type":"root","data":{"quirksMode":false}},"frontmatter":{"title":"","subtitle":null,"noheadline":null,"date":null,"abstract":null,"lang":null},"headings":[{"id":"markus-tacker","depth":2,"value":"Markus Tacker"},{"id":"connect","depth":2,"value":"Connect"}]}},"pagePath":"/javascript-dependency-management-with-greenkeeper-on-aws-codebuild"}},"staticQueryHashes":[]}